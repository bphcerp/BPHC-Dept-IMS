ALTER TABLE "phd_proposals" ADD COLUMN "active" boolean GENERATED ALWAYS AS (CASE WHEN status IN('deleted', 'completed', 'draft_expired', 'rejected')THEN NULL ELSE true END) STORED;--> statement-breakpoint
ALTER TABLE "phd_proposals" ADD CONSTRAINT "phd_proposals_student_email_active_unique" UNIQUE("student_email","active");